<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Baliwag Bus Booking Admin</title>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <img src="../images/new_baliwag_logo.png" alt="Baliwag Logo">
        </div>
        <button type="button" onclick="showSection('records')">Bus Records</button>
        <button type="button" onclick="showSection('booking')">Bus Booking</button>

        <div class="logout-btn-wrapper">
            <button type="button" id="logout" onclick="window.location.href='index.php'">Logout</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main">
        <!-- Manage RECORDS SECTIONNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN__------------------------------------- -->
        <div id="records" class="section">
            <h3>Bus Records</h3>
            <button type="button" id="addbusBtn" onclick="openModal()">+ Add Bus</button>
            <div id="containerBusses">
                <!-- Dynamic content will be injected here -->
            </div>

            <!-- Bus Info Modal if pic is cliked -->
            <div id="busInfoModal">
                <div id="innerbusInfoModal">
                    <span id="xbutt" onclick="closeBusInfo()">×</span>
                    <h3 id="busInfoTitle">Bus Info</h3>
                    <hr id="hr">
                    <p><strong>Route:</strong> <span id="busRoute"></span></p>
                    <p><strong>Travel Time:</strong> <span id="busTravelTime"></span></p>
                    <p><strong>Total Fare:</strong> ₱<span id="busTotalFare"></span></p>
                    <p><strong>Plate No.:</strong> <span id="busPlateNo"></span></p>
                    <p><strong>Driver:</strong> <span id="busDriver"></span></p>
                    <p><strong>Driver Contact:</strong> <span id="busDriverContact"></span></p>
                    <p><strong>Conductor:</strong> <span id="busConductor"></span></p>
                    <p><strong>Conductor Contact:</strong> <span id="busConductorContact"></span></p>
                    <div class="button-container">
                        <button type="button" id="btnInfMod" class="button">Edit</button>
                    </div>
                </div>
            </div>

            <!-- ADD BUS BUTTON IN BUS RECORDS MODALLLLLLLLLL -------------------------------------------->
            <div id="busModal">
                <div id="modalbusbutton">
                  <span onclick="closeModal()" id="closeModal">x</span>
                  <h3 id="addbusModal">Add Bus</h3>
              
                  <!-- Form Grid -->
                    <div id="formgrid">
                        <!-- Column 1: Image Uploads -->
                        <div class="formcol">
                        <label>Bus Image:</label>
                        <div id="imageUpload">
                            <input type="file" accept="image/*" name="busImage" onchange="previewImage(event)" id="busImageInput">
                            <label id="busImgPrev" for="busImageInput">
                            <img id="previewImage" src="../images/add_img_photo.jpg" alt="Add Image">
                            </label>
                        </div>
                
                        <label>GCash Payment QR:</label>
                        <div id="imageUpload">
                            <input type="file" accept="image/*" name="gcashQR" onchange="previewQR(event)" id="gcashQRInput">
                            <label id="qrImgPrev" for="gcashQRInput">
                            <img id="previewQRImage" src="../images/add_img_photo.jpg" alt="Add QR">
                            </label>
                        </div>
                        </div>
                
                        <!-- Column 2: Bus Info -->
                        <div class="formcol">
                        <label for="busName">Bus Name:</label>
                        <select id="busName">
                            <option value="Baliwag">Baliwag</option>
                            <option value="Golden Bee">Golden Bee</option>
                        </select>
                
                        <label>Bus Number:</label>
                        <input id="busNo" name="busNumber" type="text" placeholder="Enter bus number">
                
                        <label>Plate No.:</label>
                        <input id="plateNo" name="plateNumber" type="text" placeholder="Enter plate number">
                
                        <label>Route:</label>
                        <input id="route" name="route" type="text" placeholder="Enter route">
                
                        <label>Total Fare:</label>
                        <input id="totFare" name="totalFare" type="text" placeholder="Enter total fare">
                
                        <label>Travel Time:</label>
                        <input id="travelTime" name="travelTime" type="time" step="3600" placeholder="Enter travel time">
                        </div>
                
                        <!-- Column 3: Driver & Conductor -->
                        <div class="formcol">
                        <label>Driver Name:</label>
                        <input id="driverName" name="driverName" type="text" placeholder="Enter driver name">
                
                        <label>Driver Contact:</label>
                        <input id="driverContact" name="driverContact" type="text" placeholder="Enter driver contact">
                
                        <label>Conductor Name:</label>
                        <input id="conductorName" name="conductorName" type="text" placeholder="Enter conductor name">
                
                        <label>Conductor Contact:</label>
                        <input id="conductorContact" name="conductorContact" type="text" placeholder="Enter conductor contact">
                        </div>
                    </div>
              
                  <!-- Confirm Button -->
                  <div id="confbut">
                    <button type="button" id="confbutt">Confirm</button>
                  </div>
                </div>
            </div>
        </div>

        <!-- PANGALAWANG SECTIONNNNNNNNNNNNNNNNNNNNNNNN ------------------- BUS BOOKING SECTION ------------------------------------------------>
        <div id="booking" class="section hidden">
            <h3>Bus Booking</h3>
            <button type="button" onclick="openBookingModal()">+ Add Booking</button>
            <!-- ACEEPTED BOOKINGS SECTION ------------------------------------------------>
            <h3>Accepted Bookings</h3>
            <div id="outerAccepted">
                <table id="tblAccepted">
                    <thead id="theadAccepted">
                        <tr>
                            <th>Reference No.</th>
                            <th>Passenger Name</th>
                            <th>Contact</th>
                            <th>Bus Name</th>
                            <th>Bus Number</th>
                            <th>Route</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- laman ng table accepted -->
                        <tr>
                            <td>ZXC9823</td>
                            <td>Juan Dela Cruz</td>
                            <td>09123456789</td>
                            <td>Baliwag</td>
                            <td>1014</td>
                            <td>Manila - Cabanatuan</td>
                            <td>
                                <button class="button" onclick="showDetailsModal()">Details</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Add Booking BUTTON MODAL POP UP -->
            <div id="bookingModal">
                <div id="innerBookingModal">
                    <span id="spanBookModal" onclick="closeBookingModal()">x</span>
                    <h3>Add Booking</h3>
                    <!-- Route Search -->
                    <label>Route:</label>
                    <div id="outerSearch">
                        <input id="searchField" type="text" placeholder="Search">
                    </div>
                    <!-- Scrollable Bus Table -->
                    <div id="addbooktbl">
                        <table id="addbooktbll" border="1" width="100%">
                            <thead id="theadAccepted">
                                <!-- Header sa table ng add booking -->
                                <tr>
                                    <th>Bus No.</th>
                                    <th>Bus Name</th>
                                    <th>Travel Time</th>
                                    <th>Driver</th>
                                    <th>Conductor</th>
                                    <th>Seats Left</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data sa table ng add booking -->
                                <tr>
                                    <td>7820</td>
                                    <td>Baliwag</td>
                                    <td>1:00 PM</td>
                                    <td>Juan Dela Cruz</td>
                                    <td>Pedro Santos</td>
                                    <td>45</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <hr>
                    <!-- Passenger Info -->
                    <h4>Passenger Information</h4>
                    <div id="passInfo">
                        <div id="forminner">
                            <label>First Name:</label><br>
                            <input id="firstName" type="text" placeholder="Enter first name">
                        </div>
                        <div id="forminner">
                            <label>Last Name:</label><br>
                            <input id="lastName" type="text" placeholder="Enter last name">
                        </div>
                        <div id="forminner">
                            <label>Contact:</label><br>
                            <input id="contact" type="text" placeholder="Enter contact number">
                        </div>
                        <div id="forminner">
                            <label>Mode of Payment:</label><br>
                            <input id="modeOfPayment" type="text" value="Cash" readonly placeholder="Enter mode of payment">
                        </div>
                    </div>
                    <!-- Book Button -->
                    <div id="bookdiv">
                        <button type="button" id="bookbtn">Book</button>
                    </div>
                </div>
            </div>

            <!-- PENDING BOOKINGS SECTION ------------------------------------------------>
            <h3>Pending Bookings</h3>
            <div id="outerAccepted">
                <table id="tblAccepted">
                    <thead id="theadAccepted">
                        <tr>
                            <th>Reference No.</th>
                            <th>Date and Time</th>
                            <th>Passenger Name</th>
                            <th>Contact</th>
                            <th>Bus Name</th>
                            <th>Bus Number</th>
                            <th>Route</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- laman ng table pending booking -->
                        <tr>
                            <td>ZXC9823</td>
                            <td>2025-04-09 10:00 PM</td>
                            <td>Juan Dela Cruz</td>
                            <td>09123456789</td>
                            <td>Baliwag</td>
                            <td>1014</td>
                            <td>Manila - Cabanatuan</td>
                            <td>
                                <button type="button" id="pendDet" class="button" onclick="showDetailsModal()">Details</button>
                                <button type="button" id="accDet" class="button">Accept</button>
                                <button type="button" id="rejDet" class="button">Reject</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Booking Details Modal -->
        <div class="modal" id="detailsModal">
            <div class="modal-content">
                <h3>Booking Details</h3>
                <hr>
                <p><strong>Reference No.:</strong> ZXC9234</p>
                <p><strong>Booking Date and Time:</strong> 2025-04-08 10:00 PM</p>
                <p><strong>Passenger Name:</strong> Makiyato</p>
                <p><strong>Route:</strong> Cabanatuan - Cubao</p>
                <p><strong>Travel Time:</strong> 1:00 PM</p>
                <p><strong>Bus Name:</strong> Baliwag</p>
                <p><strong>Bus No.:</strong> 1015</p>
                <p><strong>Driver:</strong> Mang Juan</p>
                <p><strong>Conductor:</strong> Jose Manalo</p>
                <p><strong>Mode of Payment:</strong> GCash</p>
                <p><strong>Total Fare:</strong> 150</p>

                <div class="button-container">
                    <button id="butbookDet" class="button" type="button">Edit</button>
                    <button id="butbookDets" class="button" onclick="closeDetailsModal()" type="button">Close</button>
                </div>
            </div>
        </div>

        <script>
            /* PARA SA SIDEBAR */
            function showSection(id) {
                document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
                document.getElementById(id).classList.remove('hidden');
            }

            window.onclick = function(e) {
                if (e.target.id === 'modal') {
                    document.getElementById('modal').style.display = 'none';
                }
                if (e.target.id === 'detailsModal') {
                    document.getElementById('detailsModal').style.display = 'none';
                }
            }

            /* modals mga pop up window yan */
            function showDetailsModal() {
                document.getElementById('detailsModal').style.display = 'flex';
            }

            function closeDetailsModal() {
                document.getElementById('detailsModal').style.display = 'none';
            }

            /* Function to open the modal ADD BUS */
            function openModal() {
                document.getElementById('busModal').style.display = 'flex';
            }

            function closeModal() {
                document.getElementById('busModal').style.display = 'none';
            }

            function previewImage(event) {
                const reader = new FileReader();
                reader.onload = function() {
                    const output = document.getElementById('previewImage');
                    output.src = reader.result;
                };
                reader.readAsDataURL(event.target.files[0]);
            }

            function previewQR(event) {
                const output = document.getElementById('previewQRImage');
                output.src = URL.createObjectURL(event.target.files[0]);
              }              

            /* Function to open the modal add booking button cliked */
            function openBookingModal() {
                document.getElementById('bookingModal').style.display = 'flex';
            }

            function closeBookingModal() {
                document.getElementById('bookingModal').style.display = 'none';
            }




            //db php para ma save sa database
            document.getElementById("confbutt").addEventListener("click", function () {
                const formData = new FormData();
            
                // Append basic form values
                formData.append("busNumber", document.getElementById("busNo").value);
                formData.append("plateNumber", document.getElementById("plateNo").value);
                formData.append("route", document.getElementById("route").value);
                formData.append("busName", document.getElementById("busName").value);
                formData.append("totalFare", document.getElementById("totFare").value);
                formData.append("travelTime", document.getElementById("travelTime").value);
                formData.append("driverName", document.getElementById("driverName").value);
                formData.append("driverContact", document.getElementById("driverContact").value);
                formData.append("conductorName", document.getElementById("conductorName").value);
                formData.append("conductorContact", document.getElementById("conductorContact").value);
            
                // Append files
                const busImageFile = document.getElementById("busImageInput").files[0];
                const qrImageFile = document.getElementById("gcashQRInput").files[0];
                if (busImageFile) formData.append("busImage", busImageFile);
                if (qrImageFile) formData.append("gcashQR", qrImageFile);
            
                // Send to backend
                fetch("../php/addBus.php", {
                    method: "POST",
                    body: formData
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert("✅ Bus information saved successfully!");
                        closeModal(); // Optional: if you want to hide the modal
                        // Optionally reset form here too
                    } else {
                        alert("❌ Failed to save bus information. Please try again.");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("⚠️ An error occurred. Please check the console.");
                });
            });

            // SA BUS RECORDS ITO Function to show the bus info modal when a bus image is clicked para lumabas info
            document.addEventListener("DOMContentLoaded", () => {
                fetch("../php/getBuses.php")
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            const container = document.getElementById("containerBusses");
                            container.innerHTML = ""; // Clear existing template

                            data.buses.forEach(bus => {
                                const busDiv = document.createElement("div");
                                busDiv.className = "bus-card";
                                busDiv.onclick = () => showBusInfo(bus); // Pass bus to modal

                                busDiv.innerHTML = `
                                    <strong>${bus.busName} ${bus.busNumber}</strong>
                                    <img id="imgbus" src="../${bus.busImage}" alt="Bus Picture" />
                                `;

                                container.appendChild(busDiv);
                            });
                        } else {
                            alert("Failed to load buses: " + data.message);
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching buses:", error);
                    });
            });

            // Modal open handler
            function showBusInfo(bus) {
                document.getElementById("busInfoTitle").textContent = `${bus.busName} ${bus.busNumber}`;
                document.querySelector("#busInfoModal p:nth-of-type(1)").innerHTML = `<strong>Route:</strong> ${bus.route}`;
                document.querySelector("#busInfoModal p:nth-of-type(2)").innerHTML = `<strong>Travel Time:</strong> ${bus.travelTime}`;
                document.querySelector("#busInfoModal p:nth-of-type(3)").innerHTML = `<strong>Total Fare:</strong> ₱${bus.totalFare}`;
                document.querySelector("#busInfoModal p:nth-of-type(4)").innerHTML = `<strong>Plate No.:</strong> ${bus.plateNumber}`;
                document.querySelector("#busInfoModal p:nth-of-type(5)").innerHTML = `<strong>Driver:</strong> ${bus.driver.name}`;
                document.querySelector("#busInfoModal p:nth-of-type(6)").innerHTML = `<strong>Driver Contact:</strong> ${bus.driver.contact}`;
                document.querySelector("#busInfoModal p:nth-of-type(7)").innerHTML = `<strong>Conductor:</strong> ${bus.conductor.name}`;
                document.querySelector("#busInfoModal p:nth-of-type(8)").innerHTML = `<strong>Conductor Contact:</strong> ${bus.conductor.contact}`;

                document.getElementById("busInfoModal").style.display = "flex";
            }

            // Close modal
            function closeBusInfo() {
                document.getElementById("busInfoModal").style.display = "none";
            }
        </script>
</body>

</html>